// src/services/socialMedia/FIRESTORE_SCHEMA.md

# üóÑÔ∏è Social Media Posts - Firestore Schema

## Collection: `social_posts`

Complete schema documentation for the social media posts collection.

---

## Document Structure

```javascript
{
  // Meta Information
  id: string,                      // Auto-generated by Firestore
  createdAt: Timestamp,            // Auto-set on creation
  updatedAt: Timestamp,            // Auto-updated on changes
  version: number,                 // For versioning (default: 1)

  // Content Information
  platform: string,                // 'instagram' | 'facebook' | 'twitter' | 'linkedin'
  caption: string,                 // Full post caption (varies by platform)
  hashtags: string[],              // Array of hashtags
  cta: string,                     // Call to action
  contentType: string,             // 'quiz' | 'puzzle' | 'feature' | 'challenge'
  contentCategory: string,         // 'kids' | 'programming' | 'general'

  // Content References
  contentId: string,               // Reference to original quiz/puzzle ID
  contentTitle: string,            // Title of original content (optional)
  contentCategory: string,         // Original content category

  // Media
  imageUrl: string,                // Direct image URL (from Cloudinary or source)
  imagePrompt: string,             // AI image generation prompt
  imageProvider: string,           // 'cloudinary' | 'dalle' | 'midjourney' | 'user_uploaded'

  // Status Workflow
  status: string,                  // 'draft' | 'approved' | 'scheduled' | 'published' | 'deleted'
  
  // Scheduling
  scheduledFor: Timestamp,         // When the post should be published
  timezone: string,                // 'UTC' | 'EST' | 'PST' | 'IST' | etc.
  publishedAt: Timestamp,          // When post was actually published

  // Admin Notes
  notes: string,                   // Internal admin notes
  editedBy: string,                // User ID of last editor
  editHistory: Array<{
    timestamp: Timestamp,
    editedBy: string,
    changes: object
  }>,

  // Engagement Metrics (updated after publishing)
  engagementMetrics: {
    likes: number,                 // Hearts/Reactions
    comments: number,              // Comment count
    shares: number,                // Share/Retweet count
    clicks: number,                // Link clicks to website
    impressions: number,           // Total views
    reach: number,                 // Unique viewers
    engagement_rate: number,       // (engagement/impressions) * 100
    lastUpdated: Timestamp         // When metrics were last updated
  },

  // Platform-Specific Data
  platformData: {
    instagram: {
      postId: string,              // Instagram media ID (post-publish)
      insightData: object,         // Engagement from IG Insights API
    },
    facebook: {
      postId: string,              // Facebook post ID
      linkUrl: string,             // CTA link for Facebook
    },
    twitter: {
      tweetId: string,             // Tweet ID (post-publish)
      retweets: number,
      replies: number,
    },
    linkedin: {
      postId: string,              // LinkedIn post URN
      impressions: number,
      engagements: number,
    }
  }
}
```

---

## Field Descriptions

### Core Fields

| Field | Type | Description | Example |
|-------|------|-------------|---------|
| `platform` | string | Which platform this post is for | `'instagram'` |
| `caption` | string | The actual text that gets posted | Full caption text |
| `hashtags` | string[] | Hashtags in the post | `['#Learning', '#Quiz']` |
| `cta` | string | Call-to-action text | `'Play now - link in bio'` |

### Content Reference

| Field | Type | Description | Example |
|-------|------|-------------|---------|
| `contentType` | string | What kind of content | `'quiz'` or `'puzzle'` |
| `contentCategory` | string | Target audience | `'kids'` or `'programming'` |
| `contentId` | string | Reference to original | Quiz or Puzzle ID |
| `contentTitle` | string | Original title (optional) | `'Animals Quiz'` |

### Media

| Field | Type | Description | Example |
|-------|------|-------------|---------|
| `imageUrl` | string | Direct image URL | `https://cdn.cloudinary.com/...` |
| `imagePrompt` | string | Prompt for AI generation | AI image description |
| `imageProvider` | string | Where image comes from | `'cloudinary'` or `'dalle'` |

### Status & Workflow

| Field | Type | Description | Valid Values |
|-------|------|-------------|---|
| `status` | string | Current post status | `draft`, `approved`, `scheduled`, `published`, `deleted` |
| `scheduledFor` | Timestamp | Publication datetime | ISO timestamp |
| `timezone` | string | Timezone for scheduling | `UTC`, `EST`, `PST`, `IST`, etc. |
| `publishedAt` | Timestamp | Actual publish time | ISO timestamp |

### Admin & Notes

| Field | Type | Description |
|-------|------|-------------|
| `notes` | string | Internal notes for admins |
| `editedBy` | string | User ID of editor |
| `editHistory` | Array | Tracks all edits with timestamps |

### Engagement Tracking

| Field | Type | Description |
|-------|------|-------------|
| `engagementMetrics.likes` | number | Total reactions/likes |
| `engagementMetrics.comments` | number | Comment count |
| `engagementMetrics.shares` | number | Share/retweet count |
| `engagementMetrics.clicks` | number | Clicks to your site |
| `engagementMetrics.impressions` | number | Total views |
| `engagementMetrics.reach` | number | Unique people who saw it |
| `engagementMetrics.engagement_rate` | number | (engagement/impressions)*100 |

---

## Example Documents

### Example 1: Instagram Quiz Post (Draft)

```javascript
{
  id: "social_post_001",
  createdAt: Timestamp.now(),
  updatedAt: Timestamp.now(),
  version: 1,

  platform: "instagram",
  caption: "Ready for a challenge? üß† Test your Animals knowledge with our latest quiz. Can you score 10/10?\n\nLearning is fun! üéì\n\n#KidsLearning #FunLearning #EarlyEducation #KidsQuiz #LearningThroughPlay",
  hashtags: ["#KidsLearning", "#FunLearning", "#EarlyEducation", "#KidsQuiz", "#LearningThroughPlay"],
  cta: "Play now - link in bio",
  contentType: "quiz",
  contentCategory: "kids",

  contentId: "quiz_animals_123",
  contentTitle: "Animals Quiz",

  imageUrl: "https://cloudinary.com/amaha/animals-quiz.jpg",
  imagePrompt: "Create a vibrant, engaging educational image for a Kids Animals quiz...",
  imageProvider: "cloudinary",

  status: "draft",
  scheduledFor: null,
  timezone: "PST",
  publishedAt: null,

  notes: "High engagement expected - kids love animals",
  editedBy: "admin_user_1",
  editHistory: [],

  engagementMetrics: {
    likes: 0,
    comments: 0,
    shares: 0,
    clicks: 0,
    impressions: 0,
    reach: 0,
    engagement_rate: 0,
    lastUpdated: null
  },

  platformData: {
    instagram: {}
  }
}
```

### Example 2: LinkedIn Programming Post (Scheduled)

```javascript
{
  id: "social_post_002",
  createdAt: Timestamp.fromDate(new Date('2025-01-20')),
  updatedAt: Timestamp.fromDate(new Date('2025-01-21')),
  version: 1,

  platform: "linkedin",
  caption: "Did you know learning is more effective when it's fun? üí°\n\nOur Java programming content helps professionals stay sharp and competitive in their careers.\n\n#CodingChallenge #Programming #JavaQuiz #LearnToCode #CodeNewbie",
  hashtags: ["#CodingChallenge", "#Programming", "#JavaQuiz", "#LearnToCode", "#CodeNewbie"],
  cta: "Learn more",
  contentType: "quiz",
  contentCategory: "programming",

  contentId: "quiz_java_456",
  contentTitle: "Java Programming Challenge",

  imageUrl: "https://cloudinary.com/amaha/java-challenge.jpg",
  imagePrompt: "Professional coding challenge visualization...",
  imageProvider: "cloudinary",

  status: "scheduled",
  scheduledFor: Timestamp.fromDate(new Date('2025-02-05T14:00:00')),
  timezone: "EST",
  publishedAt: null,

  notes: "Target audience: Senior developers",
  editedBy: "admin_user_2",
  editHistory: [
    {
      timestamp: Timestamp.fromDate(new Date('2025-01-21')),
      editedBy: "admin_user_2",
      changes: { caption: "Updated professional tone" }
    }
  ],

  engagementMetrics: {
    likes: 0,
    comments: 0,
    shares: 0,
    clicks: 0,
    impressions: 0,
    reach: 0,
    engagement_rate: 0,
    lastUpdated: null
  },

  platformData: {
    linkedin: {}
  }
}
```

### Example 3: Twitter Post (Published)

```javascript
{
  id: "social_post_003",
  createdAt: Timestamp.fromDate(new Date('2025-01-15')),
  updatedAt: Timestamp.fromDate(new Date('2025-01-20')),
  version: 1,

  platform: "twitter",
  caption: "Test your logic skills with our latest puzzle challenge üß© How fast can you solve it? #AmAha #Learning #Puzzle",
  hashtags: ["#AmAha", "#Learning", "#Puzzle"],
  cta: "Try it now",
  contentType: "puzzle",
  contentCategory: "general",

  contentId: "puzzle_logic_789",
  contentTitle: "Logic Puzzle",

  imageUrl: "https://cloudinary.com/amaha/logic-puzzle.jpg",
  imagePrompt: "Abstract puzzle pieces connecting...",
  imageProvider: "user_uploaded",

  status: "published",
  scheduledFor: Timestamp.fromDate(new Date('2025-01-20T10:00:00')),
  timezone: "UTC",
  publishedAt: Timestamp.fromDate(new Date('2025-01-20T10:15:00')),

  notes: "Good early engagement",
  editedBy: "admin_user_1",
  editHistory: [],

  engagementMetrics: {
    likes: 127,
    comments: 23,
    shares: 45,
    clicks: 34,
    impressions: 2400,
    reach: 1890,
    engagement_rate: 6.3,
    lastUpdated: Timestamp.fromDate(new Date('2025-01-20T18:00:00'))
  },

  platformData: {
    twitter: {
      tweetId: "1234567890",
      retweets: 45,
      replies: 23
    }
  }
}
```

---

## Firestore Indexes

Recommended composite indexes for optimal querying:

```
Collection: social_posts
Indexes:
1. status + createdAt (desc)
   - For: getPostsByStatus with ordering

2. status + scheduledFor (asc)
   - For: getPostsReadyToPublish

3. platform + status + createdAt (desc)
   - For: Platform-specific filtering

4. contentType + platform + status
   - For: Content type analytics
```

---

## Security Rules

```firestore
match /social_posts/{document=**} {
  // Only admins can access
  allow read, write, delete: if request.auth.token.isAdmin == true;
  
  // Validate status transitions
  allow update: if request.auth.token.isAdmin == true && 
                   (
                     // draft -> approved
                     (resource.data.status == 'draft' && 
                      request.resource.data.status == 'approved') ||
                     // approved -> scheduled
                     (resource.data.status == 'approved' && 
                      request.resource.data.status == 'scheduled') ||
                     // scheduled -> published
                     (resource.data.status == 'scheduled' && 
                      request.resource.data.status == 'published') ||
                     // any -> deleted
                     (request.resource.data.status == 'deleted')
                   );
}
```

---

## Data Lifecycle

```
Draft (0 followers)
  ‚Üì (Admin approves)
Approved (ready to schedule)
  ‚Üì (Admin schedules date/time)
Scheduled (waiting for publish time)
  ‚Üì (Auto-publish or manual publish)
Published (live on platform)
  ‚Üì (Optional: metrics collected)
Published with Metrics (engagement tracked)
  ‚Üì (Optional: archive or delete)
Deleted (soft delete - keeps history)
```

---

## Status Explanations

- **Draft**: Post generated, awaiting review
- **Approved**: Admin reviewed, ready to schedule
- **Scheduled**: Waiting for scheduled date/time
- **Published**: Live on platform (or completed publishing)
- **Deleted**: Soft-deleted (can be recovered from editHistory)

---

## Recommended Backup Strategy

Query and backup:
```javascript
// Monthly backup of all posts
db.collection('social_posts')
  .where('status', 'in', ['published', 'deleted'])
  .where('publishedAt', '>=', startOfMonth)
  .where('publishedAt', '<=', endOfMonth)
  .get()
```

---

## Performance Considerations

- Use indexes for fast querying
- Archive old published posts (6+ months)
- Batch edit history updates
- Limit engagement metrics collection
- Consider sharding for high volume

---

**Last Updated:** December 2025
**Schema Version:** 1.0
